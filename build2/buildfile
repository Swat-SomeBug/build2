# file      : build2/buildfile
# copyright : Copyright (c) 2014-2017 Code Synthesis Ltd
# license   : MIT; see accompanying LICENSE file

import libs = libbutl%lib{butl}

exe{b}:  cxx{b} libu{b}

libu{b}: {hxx ixx txx cxx}{** -b -b-options -version} \
         {hxx ixx cxx}{b-options} {hxx}{version}      \
         $libs

cxx.poptions =+ "-I$out_root" "-I$src_root"
libu{b}: cxx.export.poptions = "-I$out_root" "-I$src_root"
libu{b}: cxx.export.libs = $libs

hxx{version}: in{version} $src_root/file{manifest}
hxx{version}: dist = true

# Pass our compiler target to be used as build2 host.
#
obj{b context}: cxx.poptions += -DBUILD2_HOST_TRIPLET=\"$cxx.target\"

if ($cxx.target.class != "windows")
  cxx.libs += -lpthread

# Generated options parser.
#
if $cli.configured
{
  cli.cxx{b-options}: cli{b}

  cli.options += -I $src_root --include-with-brackets --include-prefix build2 \
--guard-prefix BUILD2 --cxx-prologue "#include <build2/types-parsers.hxx>"    \
--cli-namespace build2::cl --generate-file-scanner --generate-parse           \
--generate-specifier

  # Usage options.
  #
  cli.options += --suppress-undocumented --long-usage --ansi-color \
--page-usage 'build2::print_$name$_' --option-length 20

  # Include generated cli files into the distribution.
  #
  cli.cxx{*}: dist = true
}
