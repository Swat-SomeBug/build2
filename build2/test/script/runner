// file      : build2/test/script/runner -*- C++ -*-
// copyright : Copyright (c) 2014-2016 Code Synthesis Ltd
// license   : MIT; see accompanying LICENSE file

#ifndef BUILD2_TEST_SCRIPT_RUNNER
#define BUILD2_TEST_SCRIPT_RUNNER

#include <build2/types>
#include <build2/utility>

#include <build2/diagnostics> // location

#include <build2/test/script/script>

namespace build2
{
  namespace test
  {
    namespace script
    {
      class runner
      {
      public:
        // Location is the scope start location (for diagnostics, etc).
        //
        virtual void
        enter (scope&, const location&) = 0;

        // Index is the 1-base index of this command in the command list
        // (e.g., in a compound test). If it is 0 then it means there is only
        // one command (e.g., a simple test). This information can be used,
        // for example, to derive file names.
        //
        // Location is the start position of this command in the testscript.
        // It can be used in diagnostics.
        //
        virtual void
        run (scope&, const command&, size_t index, const location&) = 0;

        // Location is the scope end location (for diagnostics, etc).
        //
        virtual void
        leave (scope&, const location&) = 0;
      };

      class concurrent_runner: public runner
      {
      public:
        virtual void
        enter (scope&, const location&) override;

        virtual void
        run (scope&, const command&, size_t, const location&) override;

        virtual void
        leave (scope&, const location&) override;
      };
    }
  }
}

#endif // BUILD2_TEST_SCRIPT_RUNNER
