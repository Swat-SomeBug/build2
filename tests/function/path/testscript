# file      : tests/function/path/testscript
# copyright : Copyright (c) 2014-2016 Code Synthesis Ltd
# license   : MIT; see accompanying LICENSE file

+mkdir build
+cat <<EOI >>>build/bootstrap.build
project = test
amalgamation =
EOI

test.options += -q --buildfile - noop

+if ($cxx.target.class != windows) # @@ TMP ternarry
  s = '/'
else
  s = '\'
end

: normalize
:
{
  $* <'print $normalize([path] a/../b)'              >"b"        : path
  $* <'print $normalize([paths] a/../b a/../c)'      >"b c"      : paths
  $* <'print $normalize([dir_path] a/../b)'          >"b$s"      : dir-path
  $* <'print $normalize([dir_paths] a/../b a/../c/)' >"b$s c$s"  : dir-paths
  $* <'print $path.normalize(a/../b)'                >"b"        : untyped
  $* <'print $path.normalize(a/../b/ a/../b)'        >"b$s b"    : mixed
}

: invalid-path
:
if ($cxx.target.class != windows) # @@ TMP ternarry
  p = /../foo
else
  p = c:/../foo
end;
$* <"\$path.normalize\('$p')" 2>>"EOE" != 0
error: invalid path: '$p'
EOE
