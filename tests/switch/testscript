# file      : tests/switch/testscript
# copyright : Copyright (c) 2014-2019 Code Synthesis Ltd
# license   : MIT; see accompanying LICENSE file

# Test switch.

.include ../common.testscript

: basics
:
$* <<EOI >>EOO
for i: 1 2 3 4 5
{
  switch $i
  {
    case 1
      print 1
    case 2
    {
      print 2
    }
    case 0
    case 3
      print 0,3
    case 0|4
      print 0,4
    default
      print d
  }
}
EOI
1
2
0,3
0,4
d
EOO

: basics-multiple
:
$* <<EOI >>EOO
for i: 1 2 3 4 5
{
  switch $i, $i
  {
    case 1, 1
      print 1
    case 1, 2
      assert
    case 2
    {
      print 2
    }
    case 3, 3
    case 0, 0
      print 3,0
    case 4|0, 0|4|0
      print 4,0
    default
      print d
  }
}
EOI
1
2
3,0
4,0
d
EOO

: empty
:
$* <<EOI
switch 1
{
}
EOI

: default
:
$* <<EOI >>EOO
switch 1
{
  default
    print d
}
EOI
d
EOO

: nested
:
$* <<EOI >>EOO
switch 1
{
  case 1
  {
    switch 2
    {
      case 2
        print 2
      case 1
        assert
    }
  }
  case 2
    assert
}
EOI
2
EOO

: case-default
:
$* <<EOI >>EOO
for i: 1 2
{
  switch $i
  {
    case 1
    default
      print 1,d
  }
}
EOI
1,d
1,d
EOO

: default-before-case
:
$* <<EOI 2>>EOE != 0
switch 1
{
  default
    x = 1
  case 2
    x = 2
}
EOI
<stdin>:5:3: error: case after default
  info: default must be last in the switch block
EOE

: default-multiple
:
$* <<EOI 2>>EOE != 0
switch 1
{
  default
    x = 1
  default
    x = 2
}
EOI
<stdin>:5:3: error: multiple defaults
EOE

: empty-switch
:
$* <<EOI 2>>EOE != 0
switch
{
}
EOI
<stdin>:1:7: error: expected switch expression instead of <newline>
EOE

: empty-case
:
$* <<EOI 2>>EOE != 0
switch 1
{
  case
    x = 1
}
EOI
<stdin>:3:7: error: expected case pattern instead of <newline>
EOE

: junk-in-switch
:
$* <<EOI 2>>EOE != 0
switch 1
{
  x = 0
}
EOI
<stdin>:3:3: error: expected case or default instead of 'x'
EOE

: multiple-more-patterns
:
$* <<EOI 2>>EOE != 0
switch 1
{
  case 1, 1
}
EOI
<stdin>:3:11: error: more patterns than switch expressions
EOE
