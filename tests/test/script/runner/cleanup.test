# file      : tests/test/script/runner/cleanup.test
# copyright : Copyright (c) 2014-2016 Code Synthesis Ltd
# license   : MIT; see accompanying LICENSE file

+mkdir build &build/ # @@ Should not be necessary once builtin.
+cat <<EOI >>>build/boostrap.build
project = test
amalgamation =

using test
EOI

b = $build.driver -q --no-column --buildfile - <"./: test{testscript}" \
  &test/ test
c = cat >>>testscript

$* -f a &a                                       # file
$* -d a &a/                                      # dir1
$* -d a/b &a/ &a/b/                              # dir2
$* -d a/b -f a/b/c &a/ &a/b/ &a/b/c              # file-dir
$* -f a &a &a                                    # file-dup
$* -d a/b &a/ &a/b/ &a/b/../b/                   # dir-dup

# <test-id>
#
# @@ TODO: $c <"$* &a/" && $b 2>>EOE
$c <"$* &a/";
$b 2>>EOE != 0
testscript:1: error: registered for cleanup directory test/1/a/ does not exist
EOE
