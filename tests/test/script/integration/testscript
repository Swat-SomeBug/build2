# file      : tests/test/script/integration/testscript
# copyright : Copyright (c) 2014-2016 Code Synthesis Ltd
# license   : MIT; see accompanying LICENSE file

test.options += --buildfile -
test.arguments = test

+mkdir build
#+cat <<EOI >>>build/boostrap.build
#project = test
#amalgamation =
#
#using test
#EOI
+cp $src_base/bootstrap.build build/

{
  +touch testscript foo.test bar.test

  $* <<EOI 2>>EOE != 0
./: test{../testscript ../foo}
EOI
error: both 'testscript' and other names specified for dir{./}
info: while testing dir{./}
EOE

  $* <<EOI 2>>EOE != 0
./: test{../foo ../testscript}
EOI
error: both 'testscript' and other names specified for dir{./}
info: while testing dir{./}
EOE

  $* <<EOI 2>>EOE
./: test{../foo ../bar}
EOI
test dir{./} with ../test{foo}
test dir{./} with ../test{bar}
EOE

  -rm -f testscript foo.test bar.test
}

# work-dir-not-empty-begin
#
touch foo.test;
mkdir test;
touch test/dummy;
$* <<EOI 2>>EOE != 0;
./: test{foo}
EOI
error: working directory test/ is not empty at the beginning of the test
info: while testing dir{./}
EOE
rm -f test/dummy foo.test;
rmdir test

# work-dir-not-empty-end
#
# @@ No (easy) way to test this.

-rm -f build/bootstrap.build
-rmdir build/
