# file      : tests/test/script/builtin/cat.test
# copyright : Copyright (c) 2014-2017 Code Synthesis Ltd
# license   : MIT; see accompanying LICENSE file

.include ../common.test

: in
:
$c <<EOI && $b
cat <<EOF >>EOO
foo
bar
EOF
foo
bar
EOO
EOI

: dash
:
$c <<EOI && $b
cat - <<EOF >>EOO
foo
bar
EOF
foo
bar
EOO
EOI

: file
:
$c <<EOI && $b
cat <<EOF >=out;
foo
bar
EOF
cat out >>EOO
foo
bar
EOO
EOI

: in-repeat
:
$c <<EOI && $b
cat - <<EOF >>EOO
foo
bar
EOF
foo
bar
EOO
EOI

: non-existent
:
$c <<EOI && $b
cat in 2>>/~%EOE% != 0
%cat: unable to print '.+/test/cat/non-existent/test/1/in': .+%
EOE
EOI

: empty-path
:
: Cat an empty path.
:
$c <<EOI && $b
cat '' 2>"cat: invalid path ''" == 1
EOI

: big
:
: Cat a big file (about 3MB) to test that the builtin is asynchronous.
:
{
  s="------------------------------------------------------------------------"
  s="$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s"
  s="$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s"
  s="$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s$s"
  $c <"cat <'$s' | cat >'$s'" && $b
}
